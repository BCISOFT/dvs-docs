"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[252],{786:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"tunnel/custom-hooks","title":"Hooks personnalis\xe9s Tunnel","description":"Les hooks personnalis\xe9s permettent d\'ex\xe9cuter des scripts automatiquement au d\xe9marrage ou \xe0 l\'arr\xeat d\'un tunnel.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/08-tunnel/custom-hooks.md","sourceDirName":"08-tunnel","slug":"/tunnel/custom-hooks","permalink":"/fr/docs/tunnel/custom-hooks","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1769614288000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Tunnel \ud83d\udd10","permalink":"/fr/docs/tunnel/"},"next":{"title":"dvs tunnel list","permalink":"/fr/docs/tunnel/tunnel-list"}}');var l=s(4848),r=s(8453);const i={},o="Hooks personnalis\xe9s Tunnel",a={},d=[{value:"Emplacement des hooks",id:"emplacement-des-hooks",level:2},{value:"Fonctions des hooks",id:"fonctions-des-hooks",level:2},{value:"tunnel.after_start.sh",id:"tunnelafter_startsh",level:3},{value:"tunnel.after_stop.sh",id:"tunnelafter_stopsh",level:3},{value:"Variables disponibles",id:"variables-disponibles",level:2},{value:"Cas d&#39;utilisation",id:"cas-dutilisation",level:2},{value:"Notifier un canal Slack",id:"notifier-un-canal-slack",level:3},{value:"Mettre \xe0 jour une configuration externe",id:"mettre-\xe0-jour-une-configuration-externe",level:3},{value:"Vider le cache apr\xe8s changement de tunnel",id:"vider-le-cache-apr\xe8s-changement-de-tunnel",level:3},{value:"Ordre d&#39;ex\xe9cution",id:"ordre-dex\xe9cution",level:2},{value:"Notes",id:"notes",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"hooks-personnalis\xe9s-tunnel",children:"Hooks personnalis\xe9s Tunnel"})}),"\n",(0,l.jsx)(n.p,{children:"Les hooks personnalis\xe9s permettent d'ex\xe9cuter des scripts automatiquement au d\xe9marrage ou \xe0 l'arr\xeat d'un tunnel."}),"\n",(0,l.jsx)(n.h2,{id:"emplacement-des-hooks",children:"Emplacement des hooks"}),"\n",(0,l.jsxs)(n.p,{children:["Cr\xe9ez vos hooks personnalis\xe9s dans le dossier ",(0,l.jsx)(n.code,{children:".dvs/hooks/"})," de votre application :"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/app/.dvs/hooks/\n\u251c\u2500\u2500 tunnel.after_start.sh\n\u2514\u2500\u2500 tunnel.after_stop.sh\n"})}),"\n",(0,l.jsx)(n.admonition,{title:"Contexte d'ex\xe9cution",type:"info",children:(0,l.jsxs)(n.p,{children:["Les hooks s'ex\xe9cutent dans le conteneur DVS o\xf9 ",(0,l.jsx)(n.code,{children:"/app/"})," est mont\xe9 vers le r\xe9pertoire de votre application sur l'h\xf4te. Tous les chemins de fichiers dans les hooks doivent utiliser ",(0,l.jsx)(n.code,{children:"/app/"})," comme chemin de base."]})}),"\n",(0,l.jsx)(n.h2,{id:"fonctions-des-hooks",children:"Fonctions des hooks"}),"\n",(0,l.jsx)(n.p,{children:"Chaque fichier hook doit d\xe9finir une fonction sp\xe9cifique :"}),"\n",(0,l.jsx)(n.h3,{id:"tunnelafter_startsh",children:"tunnel.after_start.sh"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Hook ex\xe9cut\xe9 apr\xe8s le d\xe9marrage du tunnel\n# Re\xe7oit l\'URL du tunnel en premier argument\n\nhook.tunnel.after_start() {\n    local tunnel_url="$1"\n    \n    # Votre code personnalis\xe9 ici\n    echo "Tunnel d\xe9marr\xe9 sur : $tunnel_url"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"tunnelafter_stopsh",children:"tunnel.after_stop.sh"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Hook ex\xe9cut\xe9 apr\xe8s l\'arr\xeat du tunnel\n\nhook.tunnel.after_stop() {\n    # Votre code personnalis\xe9 ici\n    echo "Tunnel arr\xeat\xe9"\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"variables-disponibles",children:"Variables disponibles"}),"\n",(0,l.jsx)(n.p,{children:"Dans vos hooks, vous avez acc\xe8s aux variables d'environnement DVS :"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Variable"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$APP_NAME"})}),(0,l.jsx)(n.td,{children:"Nom de l'application"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$APP_RECIPE"})}),(0,l.jsx)(n.td,{children:"Type de recette (wordpress, prestashop, lamp...)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$APP_ROOT"})}),(0,l.jsx)(n.td,{children:"Chemin racine de l'application sur l'h\xf4te"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$DVS_DOMAIN"})}),(0,l.jsxs)(n.td,{children:["Domaine DVS (ex: ",(0,l.jsx)(n.code,{children:"dvs.sh"}),")"]})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:["Le domaine local de l'application est ",(0,l.jsx)(n.code,{children:"$APP_NAME.$DVS_DOMAIN"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Pour ",(0,l.jsx)(n.code,{children:"tunnel.after_start"}),", l'URL du tunnel est pass\xe9e en premier argument (",(0,l.jsx)(n.code,{children:"$1"}),")."]}),"\n",(0,l.jsx)(n.h2,{id:"cas-dutilisation",children:"Cas d'utilisation"}),"\n",(0,l.jsx)(n.h3,{id:"notifier-un-canal-slack",children:"Notifier un canal Slack"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'hook.tunnel.after_start() {\n    local tunnel_url="$1"\n    curl -X POST -H \'Content-type: application/json\' \\\n        --data "{\\"text\\":\\"Tunnel disponible : $tunnel_url\\"}" \\\n        "$SLACK_WEBHOOK_URL"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"mettre-\xe0-jour-une-configuration-externe",children:"Mettre \xe0 jour une configuration externe"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'hook.tunnel.after_start() {\n    local tunnel_url="$1"\n    # Mettre \xe0 jour le fichier .env avec l\'URL du tunnel\n    sed -i "s|APP_URL=.*|APP_URL=$tunnel_url|" /app/.env\n}\n\nhook.tunnel.after_stop() {\n    # Restaurer l\'URL locale\n    sed -i "s|APP_URL=.*|APP_URL=https://$APP_NAME.$DVS_DOMAIN|" /app/.env\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"vider-le-cache-apr\xe8s-changement-de-tunnel",children:"Vider le cache apr\xe8s changement de tunnel"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"hook.tunnel.after_start() {\n    # Vider le cache de l'application\n    php /app/bin/console cache:clear 2>/dev/null || true\n}\n\nhook.tunnel.after_stop() {\n    php /app/bin/console cache:clear 2>/dev/null || true\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ordre-dex\xe9cution",children:"Ordre d'ex\xe9cution"}),"\n",(0,l.jsx)(n.p,{children:"Au d\xe9marrage d'un tunnel :"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Le container tunnel d\xe9marre"}),"\n",(0,l.jsx)(n.li,{children:"Le hook de recette s'ex\xe9cute (si d\xe9fini)"}),"\n",(0,l.jsxs)(n.li,{children:["Le hook utilisateur s'ex\xe9cute (",(0,l.jsx)(n.code,{children:"tunnel.after_start"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"app.update_config()"})," est appel\xe9"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\xc0 l'arr\xeat d'un tunnel :"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Le hook utilisateur s'ex\xe9cute (",(0,l.jsx)(n.code,{children:"tunnel.after_stop"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Le hook de recette s'ex\xe9cute (si d\xe9fini)"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"app.update_config()"})," est appel\xe9"]}),"\n",(0,l.jsx)(n.li,{children:"Le container tunnel s'arr\xeate"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Les hooks sont optionnels - si le fichier n'existe pas, il est ignor\xe9 silencieusement"}),"\n",(0,l.jsx)(n.li,{children:"Les hooks fournis par la recette s'ex\xe9cutent avant les hooks utilisateur au d\xe9marrage, apr\xe8s \xe0 l'arr\xeat"}),"\n",(0,l.jsxs)(n.li,{children:["Utilisez ",(0,l.jsx)(n.code,{children:"set -e"})," avec pr\xe9caution car cela peut interrompre le processus tunnel en cas d'erreur"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var t=s(6540);const l={},r=t.createContext(l);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);