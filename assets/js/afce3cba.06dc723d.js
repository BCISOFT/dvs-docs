"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2059],{3446:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"data-management/workflow/native","title":"Native Workflows","description":"Built-in deployment workflows.","source":"@site/docs/10-data-management/workflow/native.md","sourceDirName":"10-data-management/workflow","slug":"/data-management/workflow/native","permalink":"/docs/data-management/workflow/native","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1768660251000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Native Workflows"},"sidebar":"tutorialSidebar","previous":{"title":"dvs workflow validate","permalink":"/docs/data-management/workflow/validate"},"next":{"title":"dvs pull \ud83d\udd10","permalink":"/docs/data-management/pull"}}');var o=l(4848),t=l(8453);const r={sidebar_position:8,title:"Native Workflows"},a="Native Workflows",i={},d=[{value:"deploy",id:"deploy",level:2},{value:"deploy-atomic",id:"deploy-atomic",level:2},{value:"deploy-git-pull",id:"deploy-git-pull",level:2},{value:"Reference",id:"reference",level:2},{value:"deploy.yml",id:"deployyml",level:3},{value:"deploy-atomic.yml",id:"deploy-atomicyml",level:3},{value:"deploy-git-pull.yml",id:"deploy-git-pullyml",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"native-workflows",children:"Native Workflows"})}),"\n",(0,o.jsx)(n.p,{children:"Built-in deployment workflows."}),"\n",(0,o.jsx)(n.h2,{id:"deploy",children:"deploy"}),"\n",(0,o.jsx)(n.p,{children:"Standard rsync-based deployment."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"dvs deploy prod --workflow deploy\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Sync files via rsync (no delete)"}),"\n",(0,o.jsx)(n.li,{children:"Clear application cache"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use when:"})," Simple deployments, direct file sync"]}),"\n",(0,o.jsx)(n.h2,{id:"deploy-atomic",children:"deploy-atomic"}),"\n",(0,o.jsx)(n.p,{children:"Atomic deployment with release directories and symlink switch."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"dvs deploy prod --workflow deploy-atomic\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create new release directory"}),"\n",(0,o.jsx)(n.li,{children:"Sync files to release"}),"\n",(0,o.jsx)(n.li,{children:"Run post-deploy commands"}),"\n",(0,o.jsx)(n.li,{children:"Switch symlink to new release"}),"\n",(0,o.jsx)(n.li,{children:"Clean old releases"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use when:"})," Zero-downtime deployments, easy rollback"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Directory structure:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"/var/www/myapp/\n\u251c\u2500\u2500 current -> releases/20250108-143052\n\u251c\u2500\u2500 releases/\n\u2502   \u251c\u2500\u2500 20250108-143052/\n\u2502   \u251c\u2500\u2500 20250107-091500/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 shared/\n    \u251c\u2500\u2500 uploads/\n    \u2514\u2500\u2500 .env\n"})}),"\n",(0,o.jsx)(n.h2,{id:"deploy-git-pull",children:"deploy-git-pull"}),"\n",(0,o.jsx)(n.p,{children:"Git-based deployment via remote pull."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"dvs deploy prod --workflow deploy-git-pull\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"SSH to remote"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"git fetch origin"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"git reset --hard origin/main"})}),"\n",(0,o.jsx)(n.li,{children:"Run post-deploy commands"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use when:"})," Git-based workflow, remote has repo access"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,o.jsx)(n.h3,{id:"deployyml",children:"deploy.yml"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"name: deploy\ndescription: Standard deployment with file sync\n\nrequires:\n  components: [files]\n\nparameters:\n  include_database:\n    default: false\n    description: Also deploy database (disabled for e-commerce by default)\n\nsteps:\n  - action: component.files.push\n\n  - action: component.database.push\n    when: $include_database || component.database.empty\n"})}),"\n",(0,o.jsx)(n.h3,{id:"deploy-atomicyml",children:"deploy-atomic.yml"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'name: deploy-atomic\ndescription: Zero-downtime deployment with symlinks and rollback\n\nrequires:\n  transport: ssh\n  components: [files]\n\nparameters:\n  releases_keep:\n    default: 5\n    description: Number of releases to keep\n  shared_folders:\n    default: ""\n    description: Comma-separated list of shared folders (relative to webroot)\n  current_link:\n    default: current\n    description: Name of the symlink pointing to current release\n\nsteps:\n  - action: ssh.create_release_dir\n\n  - action: component.files.push\n    target: $RELEASE_DIR\n\n  - action: ssh.link_shared_folders\n    folders: $shared_folders\n    when: $shared_folders\n\n  - action: ssh.switch_symlink\n    link: $current_link\n    target: $RELEASE_DIR\n\n  - action: ssh.cleanup_releases\n    keep: $releases_keep\n'})}),"\n",(0,o.jsx)(n.h3,{id:"deploy-git-pullyml",children:"deploy-git-pull.yml"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'name: deploy-git-pull\ndescription: Deploy by pulling latest code from git repository on remote\n\nrequires:\n  transport: ssh\n  components: [files]\n\nparameters:\n  branch:\n    default: main\n    description: Git branch to pull\n  include_database:\n    default: false\n    description: Also deploy database (disabled for e-commerce by default)\n  composer_install:\n    default: true\n    description: Run composer install after git pull\n  cache_clear:\n    default: true\n    description: Clear application cache after deployment\n\nsteps:\n  - action: ssh.run\n    command: "cd $REMOTE_PATH && git fetch origin && git pull origin $branch"\n    description: Pull latest code from git repository\n\n  - action: ssh.run\n    command: "cd $REMOTE_PATH && composer install --no-dev --optimize-autoloader"\n    when: $composer_install\n    description: Install PHP dependencies with composer\n\n  - action: ssh.run\n    command: "cd $REMOTE_PATH && php artisan cache:clear 2>/dev/null || rm -rf var/cache/* app/cache/* cache/* 2>/dev/null || true"\n    when: $cache_clear\n    description: Clear application cache\n\n  - action: component.database.push\n    when: $include_database || component.database.empty\n    description: Push database to remote\n'})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>a});var s=l(6540);const o={},t=s.createContext(o);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);