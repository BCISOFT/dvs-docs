"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3107],{8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const l={},o=s.createContext(l);function a(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},8710:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tunnel/custom-hooks","title":"Custom Tunnel Hooks","description":"Custom hooks allow you to execute scripts automatically when a tunnel starts or stops.","source":"@site/docs/08-tunnel/custom-hooks.md","sourceDirName":"08-tunnel","slug":"/tunnel/custom-hooks","permalink":"/docs/tunnel/custom-hooks","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1769099911000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Tunnel \ud83d\udd10","permalink":"/docs/tunnel/"},"next":{"title":"dvs tunnel list","permalink":"/docs/tunnel/tunnel-list"}}');var l=t(4848),o=t(8453);const a={},r="Custom Tunnel Hooks",i={},c=[{value:"Hook Location",id:"hook-location",level:2},{value:"Hook Functions",id:"hook-functions",level:2},{value:"tunnel.after_start.sh",id:"tunnelafter_startsh",level:3},{value:"tunnel.after_stop.sh",id:"tunnelafter_stopsh",level:3},{value:"Available Variables",id:"available-variables",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Notify a Slack channel",id:"notify-a-slack-channel",level:3},{value:"Update external configuration",id:"update-external-configuration",level:3},{value:"Clear cache after tunnel change",id:"clear-cache-after-tunnel-change",level:3},{value:"Execution Order",id:"execution-order",level:2},{value:"Notes",id:"notes",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"custom-tunnel-hooks",children:"Custom Tunnel Hooks"})}),"\n",(0,l.jsx)(n.p,{children:"Custom hooks allow you to execute scripts automatically when a tunnel starts or stops."}),"\n",(0,l.jsx)(n.h2,{id:"hook-location",children:"Hook Location"}),"\n",(0,l.jsxs)(n.p,{children:["Create your custom hooks in the ",(0,l.jsx)(n.code,{children:".dvs/hooks/"})," folder of your application:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/app/.dvs/hooks/\n\u251c\u2500\u2500 tunnel.after_start.sh\n\u2514\u2500\u2500 tunnel.after_stop.sh\n"})}),"\n",(0,l.jsx)(n.admonition,{title:"Execution Context",type:"info",children:(0,l.jsxs)(n.p,{children:["Hooks run inside the DVS container where ",(0,l.jsx)(n.code,{children:"/app/"})," is mounted to your application directory on the host. All file paths in hooks should use ",(0,l.jsx)(n.code,{children:"/app/"})," as the base path."]})}),"\n",(0,l.jsx)(n.h2,{id:"hook-functions",children:"Hook Functions"}),"\n",(0,l.jsx)(n.p,{children:"Each hook file must define a specific function:"}),"\n",(0,l.jsx)(n.h3,{id:"tunnelafter_startsh",children:"tunnel.after_start.sh"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Hook executed after tunnel starts\n# Receives tunnel URL as first argument\n\nhook.tunnel.after_start() {\n    local tunnel_url="$1"\n    \n    # Your custom code here\n    echo "Tunnel started at: $tunnel_url"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"tunnelafter_stopsh",children:"tunnel.after_stop.sh"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Hook executed after tunnel stops\n\nhook.tunnel.after_stop() {\n    # Your custom code here\n    echo "Tunnel stopped"\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"available-variables",children:"Available Variables"}),"\n",(0,l.jsx)(n.p,{children:"Inside your hooks, you have access to DVS environment variables:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Variable"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$APP_NAME"})}),(0,l.jsx)(n.td,{children:"Application name"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$APP_RECIPE"})}),(0,l.jsx)(n.td,{children:"Recipe type (wordpress, prestashop, lamp...)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$APP_ROOT"})}),(0,l.jsx)(n.td,{children:"Application root path on host"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"$DVS_DOMAIN"})}),(0,l.jsxs)(n.td,{children:["DVS domain (e.g., ",(0,l.jsx)(n.code,{children:"dvs.sh"}),")"]})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:["The local application domain is ",(0,l.jsx)(n.code,{children:"$APP_NAME.$DVS_DOMAIN"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["For ",(0,l.jsx)(n.code,{children:"tunnel.after_start"}),", the tunnel URL is passed as the first argument (",(0,l.jsx)(n.code,{children:"$1"}),")."]}),"\n",(0,l.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,l.jsx)(n.h3,{id:"notify-a-slack-channel",children:"Notify a Slack channel"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'hook.tunnel.after_start() {\n    local tunnel_url="$1"\n    curl -X POST -H \'Content-type: application/json\' \\\n        --data "{\\"text\\":\\"Tunnel available: $tunnel_url\\"}" \\\n        "$SLACK_WEBHOOK_URL"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"update-external-configuration",children:"Update external configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'hook.tunnel.after_start() {\n    local tunnel_url="$1"\n    # Update .env file with tunnel URL\n    sed -i "s|APP_URL=.*|APP_URL=$tunnel_url|" /app/.env\n}\n\nhook.tunnel.after_stop() {\n    # Restore local URL\n    sed -i "s|APP_URL=.*|APP_URL=https://$APP_NAME.$DVS_DOMAIN|" /app/.env\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"clear-cache-after-tunnel-change",children:"Clear cache after tunnel change"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"hook.tunnel.after_start() {\n    # Clear application cache\n    php /app/bin/console cache:clear 2>/dev/null || true\n}\n\nhook.tunnel.after_stop() {\n    php /app/bin/console cache:clear 2>/dev/null || true\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"execution-order",children:"Execution Order"}),"\n",(0,l.jsx)(n.p,{children:"When starting a tunnel:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Tunnel container starts"}),"\n",(0,l.jsx)(n.li,{children:"Recipe hook executes (if defined)"}),"\n",(0,l.jsxs)(n.li,{children:["User hook executes (",(0,l.jsx)(n.code,{children:"tunnel.after_start"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"app.update_config()"})," is called"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"When stopping a tunnel:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["User hook executes (",(0,l.jsx)(n.code,{children:"tunnel.after_stop"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Recipe hook executes (if defined)"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"app.update_config()"})," is called"]}),"\n",(0,l.jsx)(n.li,{children:"Tunnel container stops"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Hooks are optional - if the file doesn't exist, it's silently ignored"}),"\n",(0,l.jsx)(n.li,{children:"Recipe-provided hooks run before user hooks on start, after on stop"}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"set -e"})," carefully as it may interrupt the tunnel process on errors"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);